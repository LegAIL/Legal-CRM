(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7403],{7403:function(e,s,t){Promise.resolve().then(t.bind(t,552)),Promise.resolve().then(t.bind(t,7668))},552:function(e,s,t){"use strict";t.d(s,{CaseDetailView:function(){return ep}});var a=t(7437),l=t(2265),r=t(2869),i=t(6070),n=t(271),d=t(4508);let c=n.fC,o=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.aV,{ref:t,className:(0,d.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));o.displayName=n.aV.displayName;let m=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.xz,{ref:t,className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));m.displayName=n.xz.displayName;let x=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.VY,{ref:t,className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));x.displayName=n.VY.displayName;var h=t(5974),u=t(2759),f=t(4930);let p=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(f.fC,{ref:t,className:(0,d.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));p.displayName=f.fC.displayName;let j=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(f.Ee,{ref:t,className:(0,d.cn)("aspect-square h-full w-full",e),...s}));j.displayName=f.Ee.displayName;let g=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(f.NY,{ref:t,className:(0,d.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));g.displayName=f.NY.displayName;var N=t(2451),v=t(5805),y=t(5954),b=t(2934),w=t(8736),k=t(8501),C=t(4502),S=t(6475),D=t(6362),Z=t(519),R=t(1047),T=t(1723),$=t(3417),z=t(5252),E=t(7648),F=t(5710),A=t(6110),I=t(6818),_=t(1800),L=t(9397),O=t(9376),V=t(4438);function Y({caseId:e}){let[s,t]=(0,l.useState)(!1),[i,n]=(0,l.useState)(!1),[d,c]=(0,l.useState)(""),[o,m]=(0,l.useState)(!1),x=(0,O.useRouter)(),h=async s=>{if(s.preventDefault(),d.trim()){n(!0);try{if((await fetch(`/api/cases/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:d.trim(),isInternal:o})})).ok)c(""),m(!1),t(!1),x.refresh(),V.Am.success("Comment added successfully");else throw Error("Failed to add comment")}catch(e){V.Am.error("Failed to add comment")}finally{n(!1)}}};return(0,a.jsxs)(A.Vq,{open:s,onOpenChange:t,children:[(0,a.jsx)(A.hg,{asChild:!0,children:(0,a.jsxs)(r.z,{size:"sm",variant:"outline",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4 mr-2"}),"Skriv meddelande"]})}),(0,a.jsxs)(A.cZ,{className:"max-w-md",children:[(0,a.jsx)(A.fK,{children:(0,a.jsx)(A.$N,{children:"Nytt meddelande i Case Chat"})}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(I.g,{placeholder:"Skriv ditt meddelande...",value:d,onChange:e=>c(e.target.value),rows:4,required:!0,className:"resize-none"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.X,{id:"internal",checked:o,onCheckedChange:e=>m(e)}),(0,a.jsx)("label",{htmlFor:"internal",className:"text-sm text-muted-foreground",children:"Internt meddelande (ej synligt f\xf6r klient)"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Avbryt"}),(0,a.jsx)(r.z,{type:"submit",disabled:i||!d.trim(),children:i?"Skickar...":"Skicka meddelande"})]})]})]})]})}var H=t(5186),P=t(6815);function U({caseId:e}){let[s,t]=(0,l.useState)(!1),[i,n]=(0,l.useState)(!1),[d,c]=(0,l.useState)({description:"",hours:"",date:new Date().toISOString().split("T")[0],billable:!0,hourlyRate:""}),o=(0,O.useRouter)(),m=async s=>{if(s.preventDefault(),!(!d.hours||0>=parseFloat(d.hours))){n(!0);try{if((await fetch(`/api/cases/${e}/time-entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:d.description.trim(),hours:parseFloat(d.hours),date:new Date(d.date).toISOString(),billable:d.billable,hourlyRate:d.hourlyRate?parseFloat(d.hourlyRate):null})})).ok)c({description:"",hours:"",date:new Date().toISOString().split("T")[0],billable:!0,hourlyRate:""}),t(!1),o.refresh(),V.Am.success("Time entry added successfully");else throw Error("Failed to add time entry")}catch(e){V.Am.error("Failed to add time entry")}finally{n(!1)}}};return(0,a.jsxs)(A.Vq,{open:s,onOpenChange:t,children:[(0,a.jsx)(A.hg,{asChild:!0,children:(0,a.jsxs)(r.z,{children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Log Time"]})}),(0,a.jsxs)(A.cZ,{children:[(0,a.jsx)(A.fK,{children:(0,a.jsx)(A.$N,{children:"Log Time Entry"})}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"date",children:"Date"}),(0,a.jsx)(H.I,{id:"date",type:"date",value:d.date,onChange:e=>c(s=>({...s,date:e.target.value})),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"hours",children:"Hours"}),(0,a.jsx)(H.I,{id:"hours",type:"number",step:"0.25",min:"0.25",placeholder:"1.5",value:d.hours,onChange:e=>c(s=>({...s,hours:e.target.value})),required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"description",children:"Description"}),(0,a.jsx)(I.g,{id:"description",placeholder:"What did you work on?",value:d.description,onChange:e=>c(s=>({...s,description:e.target.value})),rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"hourlyRate",children:"Hourly Rate ($)"}),(0,a.jsx)(H.I,{id:"hourlyRate",type:"number",step:"0.01",min:"0",placeholder:"150.00",value:d.hourlyRate,onChange:e=>c(s=>({...s,hourlyRate:e.target.value}))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.X,{id:"billable",checked:d.billable,onCheckedChange:e=>c(s=>({...s,billable:e}))}),(0,a.jsx)(P._,{htmlFor:"billable",className:"text-sm",children:"Billable time"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(r.z,{type:"submit",disabled:i||!d.hours,children:"Log Time"})]})]})]})]})}var B=t(3647);function W({caseId:e}){let[s,t]=(0,l.useState)(!1),[i,n]=(0,l.useState)(!1),[d,c]=(0,l.useState)({type:"statute",title:"",citation:"",url:"",summary:"",relevance:""}),o=(0,O.useRouter)(),m=async s=>{if(s.preventDefault(),d.title.trim()&&d.citation.trim()){n(!0);try{if((await fetch(`/api/cases/${e}/legal-references`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:d.type,title:d.title.trim(),citation:d.citation.trim(),url:d.url.trim()||null,summary:d.summary.trim()||null,relevance:d.relevance.trim()||null})})).ok)c({type:"statute",title:"",citation:"",url:"",summary:"",relevance:""}),t(!1),o.refresh(),V.Am.success("Legal reference added successfully");else throw Error("Failed to add legal reference")}catch(e){V.Am.error("Failed to add legal reference")}finally{n(!1)}}};return(0,a.jsxs)(A.Vq,{open:s,onOpenChange:t,children:[(0,a.jsx)(A.hg,{asChild:!0,children:(0,a.jsxs)(r.z,{children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 mr-2"}),"Add Legal Reference"]})}),(0,a.jsxs)(A.cZ,{className:"max-w-2xl",children:[(0,a.jsx)(A.fK,{children:(0,a.jsx)(A.$N,{children:"Add Legal Reference"})}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"type",children:"Type"}),(0,a.jsxs)(B.Ph,{value:d.type,onValueChange:e=>c(s=>({...s,type:e})),children:[(0,a.jsx)(B.i4,{children:(0,a.jsx)(B.ki,{})}),(0,a.jsxs)(B.Bw,{children:[(0,a.jsx)(B.Ql,{value:"statute",children:"Statute"}),(0,a.jsx)(B.Ql,{value:"case_law",children:"Case Law"}),(0,a.jsx)(B.Ql,{value:"regulation",children:"Regulation"}),(0,a.jsx)(B.Ql,{value:"article",children:"Legal Article"}),(0,a.jsx)(B.Ql,{value:"other",children:"Other"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"title",children:"Title"}),(0,a.jsx)(H.I,{id:"title",placeholder:"e.g., Smith v. Johnson",value:d.title,onChange:e=>c(s=>({...s,title:e.target.value})),required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"citation",children:"Citation"}),(0,a.jsx)(H.I,{id:"citation",placeholder:"e.g., 123 F.3d 456 (9th Cir. 2023)",value:d.citation,onChange:e=>c(s=>({...s,citation:e.target.value})),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"url",children:"URL (Optional)"}),(0,a.jsx)(H.I,{id:"url",type:"url",placeholder:"https://...",value:d.url,onChange:e=>c(s=>({...s,url:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"summary",children:"Summary"}),(0,a.jsx)(I.g,{id:"summary",placeholder:"Brief summary of the legal principle or holding...",value:d.summary,onChange:e=>c(s=>({...s,summary:e.target.value})),rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"relevance",children:"Relevance to Case"}),(0,a.jsx)(I.g,{id:"relevance",placeholder:"How does this reference apply to our case?...",value:d.relevance,onChange:e=>c(s=>({...s,relevance:e.target.value})),rows:2})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(r.z,{type:"submit",disabled:i||!d.title.trim()||!d.citation.trim(),children:"Add Reference"})]})]})]})]})}var q=t(277);let Q=q.fC,M=q.xz,G=q.h_,J=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(q.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:t}));J.displayName=q.aV.displayName;let K=l.forwardRef(({className:e,...s},t)=>(0,a.jsxs)(G,{children:[(0,a.jsx)(J,{}),(0,a.jsx)(q.VY,{ref:t,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));K.displayName=q.VY.displayName;let X=({className:e,...s})=>(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...s});X.displayName="AlertDialogHeader";let ee=({className:e,...s})=>(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});ee.displayName="AlertDialogFooter";let es=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(q.Dx,{ref:t,className:(0,d.cn)("text-lg font-semibold",e),...s}));es.displayName=q.Dx.displayName;let et=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(q.dk,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",e),...s}));et.displayName=q.dk.displayName;let ea=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(q.aU,{ref:t,className:(0,d.cn)((0,r.d)(),e),...s}));ea.displayName=q.aU.displayName;let el=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(q.$j,{ref:t,className:(0,d.cn)((0,r.d)({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));el.displayName=q.$j.displayName;var er=t(1905),ei=t(8930),en=t(8896),ed=t(795),ec=t(3662),eo=t(9892);function em({step:e,index:s,caseId:t,onToggle:l,onDelete:n,getUserDisplayName:d}){let{attributes:c,listeners:o,setNodeRef:m,transform:x,transition:u,isDragging:f}=(0,ec.nB)({id:e.id}),N={transform:eo.ux.Transform.toString(x),transition:u,opacity:f?.5:1};return(0,a.jsxs)("div",{ref:m,style:N,className:"relative flex items-start gap-4 group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-semibold text-primary",children:s+1})}),(0,a.jsx)("div",{...c,...o,className:"cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(er.Z,{className:"w-4 h-4 text-muted-foreground"})}),(0,a.jsx)("button",{onClick:()=>l(e.id),className:`w-6 h-6 rounded-full flex items-center justify-center transition-colors ${e.completed?"bg-green-500 hover:bg-green-600":"bg-border hover:bg-border/80"}`,children:e.completed?(0,a.jsx)(b.Z,{className:"w-4 h-4 text-white"}):(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)(i.Zb,{className:`${e.completed?"opacity-75":""} hover:shadow-md transition-shadow`,children:(0,a.jsxs)(i.aY,{className:"pt-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("h3",{className:`font-semibold ${e.completed?"line-through text-muted-foreground":"text-foreground"}`,children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.completed&&e.completedAt&&(0,a.jsxs)(h.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 mr-1"}),"Completed ",(0,F.Q)(new Date(e.completedAt),{addSuffix:!0})]}),(0,a.jsxs)(Q,{children:[(0,a.jsx)(M,{asChild:!0,children:(0,a.jsx)(r.z,{size:"sm",variant:"ghost",className:"opacity-0 group-hover:opacity-100 transition-opacity text-destructive hover:text-destructive",children:(0,a.jsx)(ei.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(K,{children:[(0,a.jsxs)(X,{children:[(0,a.jsx)(es,{children:"Ta bort workflow-steg"}),(0,a.jsxs)(et,{children:['\xc4r du s\xe4ker p\xe5 att du vill ta bort steget "',e.title,'"? Denna \xe5tg\xe4rd kan inte \xe5ngras.']})]}),(0,a.jsxs)(ee,{children:[(0,a.jsx)(el,{children:"Avbryt"}),(0,a.jsx)(ea,{onClick:()=>n(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Ta bort"})]})]})]})]})]}),e.description&&(0,a.jsx)("p",{className:`text-sm mb-3 ${e.completed?"text-muted-foreground":""}`,children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground flex-wrap",children:[e.assignedTo&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(p,{className:"w-4 h-4",children:[(0,a.jsx)(j,{src:e.assignedTo.image||""}),(0,a.jsx)(g,{className:"text-xs",children:d(e.assignedTo).slice(0,2).toUpperCase()})]}),(0,a.jsx)("span",{children:d(e.assignedTo)})]}),e.estimatedHours&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(T.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:[e.estimatedHours,"h estimated"]})]}),e.dueDate&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(R.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:new Date(e.dueDate)<new Date&&!e.completed?"text-red-500 font-medium":"",children:new Date(e.dueDate).toLocaleDateString("sv-SE")})]})]})]})})})]})}function ex({caseId:e,users:s}){let[t,i]=(0,l.useState)(!1),[n,d]=(0,l.useState)(!1),[c,o]=(0,l.useState)({title:"",description:"",assignedToId:"",estimatedHours:"",dueDate:""}),m=(0,O.useRouter)(),x=async s=>{if(s.preventDefault(),c.title.trim()){d(!0);try{if((await fetch(`/api/cases/${e}/workflow-steps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:c.title.trim(),description:c.description.trim()||null,assignedToId:c.assignedToId||null,estimatedHours:c.estimatedHours?parseFloat(c.estimatedHours):null,dueDate:c.dueDate?new Date(c.dueDate).toISOString():null})})).ok)o({title:"",description:"",assignedToId:"",estimatedHours:"",dueDate:""}),i(!1),m.refresh(),V.Am.success("Workflow step added successfully");else throw Error("Failed to add workflow step")}catch(e){V.Am.error("Failed to add workflow step")}finally{d(!1)}}},h=e=>e?.name||`${e?.firstName||""} ${e?.lastName||""}`.trim()||e?.email||"Unknown";return(0,a.jsxs)(A.Vq,{open:t,onOpenChange:i,children:[(0,a.jsx)(A.hg,{asChild:!0,children:(0,a.jsxs)(r.z,{children:[(0,a.jsx)(L.Z,{className:"w-4 h-4 mr-2"}),"Add Step"]})}),(0,a.jsxs)(A.cZ,{className:"max-w-md",children:[(0,a.jsx)(A.fK,{children:(0,a.jsx)(A.$N,{children:"Add Workflow Step"})}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"title",children:"Title *"}),(0,a.jsx)(H.I,{id:"title",value:c.title,onChange:e=>o(s=>({...s,title:e.target.value})),placeholder:"e.g., Client consultation, File documents",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"description",children:"Description"}),(0,a.jsx)(I.g,{id:"description",value:c.description,onChange:e=>o(s=>({...s,description:e.target.value})),placeholder:"Detailed description of what needs to be done...",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"assignedTo",children:"Assign to"}),(0,a.jsxs)(B.Ph,{value:c.assignedToId||"unassigned",onValueChange:e=>o(s=>({...s,assignedToId:"unassigned"===e?"":e})),children:[(0,a.jsx)(B.i4,{children:(0,a.jsx)(B.ki,{placeholder:"Select person"})}),(0,a.jsxs)(B.Bw,{children:[(0,a.jsx)(B.Ql,{value:"unassigned",children:"Unassigned"}),s?.map(e=>a.jsx(B.Ql,{value:e.id,children:h(e)},e.id))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"estimatedHours",children:"Est. Hours"}),(0,a.jsx)(H.I,{id:"estimatedHours",type:"number",step:"0.25",min:"0",value:c.estimatedHours,onChange:e=>o(s=>({...s,estimatedHours:e.target.value})),placeholder:"2.5"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(P._,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsx)(H.I,{id:"dueDate",type:"date",value:c.dueDate,onChange:e=>o(s=>({...s,dueDate:e.target.value}))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,a.jsx)(r.z,{type:"submit",disabled:n||!c.title.trim(),children:n?"Adding...":"Add Step"})]})]})]})]})}function eh({caseId:e,steps:s,users:t,currentUser:r}){let n=(0,O.useRouter)(),[d,c]=(0,l.useState)(s),o=(0,ed.Dy)((0,ed.VT)(ed.we),(0,ed.VT)(ed.Lg,{coordinateGetter:ec.is})),m=d.filter(e=>e.completed).length,x=d.length,h=x>0?m/x*100:0,f=e=>e?.name||`${e?.firstName||""} ${e?.lastName||""}`.trim()||e?.email||"Unknown",p=async t=>{let{active:a,over:l}=t;if(!l||a.id===l.id)return;let r=d.findIndex(e=>e.id===a.id),i=d.findIndex(e=>e.id===l.id),o=(0,ec.Rp)(d,r,i);c(o);try{if((await fetch(`/api/cases/${e}/workflow-steps/reorder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stepIds:o.map(e=>e.id)})})).ok)n.refresh(),V.Am.success("Workflow order updated");else throw Error("Failed to update order")}catch(e){c(s),V.Am.error("Failed to update workflow order")}},j=async s=>{try{if((await fetch(`/api/cases/${e}/workflow-steps/${s}/toggle`,{method:"POST"})).ok)n.refresh(),V.Am.success("Step updated");else throw Error("Failed to toggle step")}catch(e){V.Am.error("Failed to update step")}},g=async s=>{try{if((await fetch(`/api/cases/${e}/workflow-steps/${s}`,{method:"DELETE"})).ok)n.refresh(),V.Am.success("Step deleted");else throw Error("Failed to delete step")}catch(e){V.Am.error("Failed to delete step")}};return 0===x?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Case Workflow & Steps"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage workflow steps and track progress through key legal process stages"})]}),(0,a.jsx)(ex,{caseId:e,users:t})]}),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"flex flex-col items-center justify-center py-16",children:[(0,a.jsx)(en.Z,{className:"w-16 h-16 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Workflow Steps Defined"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4 text-center",children:"Start by adding workflow steps to organize and track the progress of this case."}),(0,a.jsx)(ex,{caseId:e,users:t})]})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Case Workflow & Steps"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage workflow steps and track progress through key legal process stages"})]}),(0,a.jsx)(ex,{caseId:e,users:t})]}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Workflow Progress"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[m," of ",x," steps completed"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-primary",children:[Math.round(h),"%"]}),(0,a.jsx)(u.Progress,{value:h,className:"w-24 mt-1"})]})]})})}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(en.Z,{className:"h-5 w-5"}),"Workflow Steps (",x,")"]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Drag steps to reorder • Click circles to toggle completion"})]})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)(ed.LB,{sensors:o,collisionDetection:ed.pE,onDragEnd:p,children:(0,a.jsx)(ec.Fo,{items:d.map(e=>e.id),strategy:ec.qw,children:(0,a.jsx)("div",{className:"space-y-4",children:d.map((s,t)=>(0,a.jsx)(em,{step:s,index:t,caseId:e,onToggle:j,onDelete:g,getUserDisplayName:f},s.id))})})})})]})]})}let eu={NEW:"bg-blue-500",IN_PROGRESS:"bg-yellow-500",REVIEW:"bg-purple-500",COMPLETED:"bg-green-500"},ef={LOW:"bg-green-600",MEDIUM:"bg-yellow-600",HIGH:"bg-orange-600",URGENT:"bg-red-600"};function ep({caseData:e,currentUser:s,users:t}){let[n,d]=(0,l.useState)("overview"),f=e.timeEntries.filter(e=>e.billable).reduce((e,s)=>e+(s.amount||0),0),A=(e.workflowSteps||[]).filter(e=>e.completed).length,I=(e.workflowSteps||[]).length,_=(e.milestones||[]).filter(e=>e.completed).length,L=(e.milestones||[]).length;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E.default,{href:"/cases",children:(0,a.jsxs)(r.z,{variant:"outline",size:"sm",className:"mb-4",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Back to Cases"]})}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(h.C,{className:eu[e.status],children:e.status.replace("_"," ")}),(0,a.jsxs)(h.C,{variant:"outline",className:ef[e.priority],children:[e.priority," Priority"]}),(0,a.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-1"}),e.assignedTo?.name||"Unassigned"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold law-gold",children:["$",f.toLocaleString()]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Billable"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[e.progress,"%"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Progress"})]}),(0,a.jsx)(u.Progress,{value:e.progress,className:"w-16"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[e.actualHours.toFixed(1),"h"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Hours Logged"})]}),(0,a.jsx)(y.Z,{className:"w-8 h-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[_,"/",L]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Milestones"})]}),(0,a.jsx)(b.Z,{className:"w-8 h-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.files.length}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Documents"})]}),(0,a.jsx)(w.Z,{className:"w-8 h-8 text-muted-foreground"})]})})})]})]}),(0,a.jsxs)(c,{value:n,onValueChange:d,className:"w-full",children:[(0,a.jsxs)(o,{className:"grid w-full grid-cols-6",children:[(0,a.jsx)(m,{value:"overview",onClick:()=>d("overview"),children:"Overview"}),(0,a.jsx)(m,{value:"milestones",onClick:()=>d("milestones"),children:"Workflow"}),(0,a.jsx)(m,{value:"documents",onClick:()=>d("documents"),children:"Documents"}),(0,a.jsx)(m,{value:"time",onClick:()=>d("time"),children:"Time Tracking"}),(0,a.jsx)(m,{value:"legal",onClick:()=>d("legal"),children:"Legal Research"}),(0,a.jsx)(m,{value:"activity",onClick:()=>d("activity"),children:"Activity"})]}),(0,a.jsx)(x,{value:"overview",className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)(i.Zb,{className:"lg:col-span-2",children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"\xc4rendedetaljer"})}),(0,a.jsxs)(i.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4"}),"Beskrivning"]}),(0,a.jsx)("p",{className:"text-muted-foreground bg-muted p-3 rounded-md",children:e.description||"Ingen beskrivning tillg\xe4nglig"})]}),e.clientName&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4"}),"Klientinformation"]}),(0,a.jsxs)("div",{className:"bg-muted p-3 rounded-md space-y-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Namn:"})," ",e.clientName]}),e.clientEmail&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"E-post:"}),(0,a.jsx)("a",{href:`mailto:${e.clientEmail}`,className:"text-blue-600 hover:underline ml-1",children:e.clientEmail})]})]}),e.clientPhone&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Telefon:"}),(0,a.jsx)("a",{href:`tel:${e.clientPhone}`,className:"text-blue-600 hover:underline ml-1",children:e.clientPhone})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),"\xc4rendeinformation"]}),(0,a.jsx)("div",{className:"bg-muted p-3 rounded-md",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Skapades:"})," ",new Date(e.createdAt).toLocaleDateString("sv-SE")]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Skapad av:"})," ",e.createdBy.name]}),e.dueDate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Slutdatum:"}),(0,a.jsx)("span",{className:`ml-1 ${new Date(e.dueDate)<new Date?"text-red-600 font-semibold":""}`,children:new Date(e.dueDate).toLocaleDateString("sv-SE")})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Ansvarig:"})," ",e.assignedTo?.name||"Ej tilldelad"]}),e.estimatedHours&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Uppskattade timmar:"})," ",e.estimatedHours,"h"]}),e.hourlyRate&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Timtariff:"})," $",e.hourlyRate.toLocaleString()]})]})})]}),e.tags.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Taggar"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tags.map((e,s)=>(0,a.jsx)(h.C,{variant:"secondary",className:"text-xs",children:e},s))})]}),e.legalStatutes&&e.legalStatutes.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4"}),"Till\xe4mpliga Lagrum"]}),(0,a.jsx)("div",{className:"space-y-3",children:e.legalStatutes.map(e=>(0,a.jsxs)(i.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.C,{variant:"outline",className:"text-xs",children:e.priority||"MEDIUM"}),(0,a.jsx)(h.C,{variant:"REVIEWED"===e.status?"default":"secondary",className:"text-xs",children:"TO_REVIEW"===e.status?"Ska granskas":"REVIEWED"===e.status?"Granskad":"Ej till\xe4mplig"})]}),e.url&&(0,a.jsx)(r.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs",children:"Visa lagtext"})})]}),(0,a.jsxs)("h5",{className:"font-medium text-sm mb-1",children:[e.title,e.chapter&&` - ${e.chapter}`,e.section&&` ${e.section}`]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:e.description}),e.notes&&(0,a.jsxs)("div",{className:"bg-blue-50 p-2 rounded text-xs",children:[(0,a.jsx)("span",{className:"font-medium",children:"Anteckningar f\xf6r detta \xe4rende:"})," ",e.notes]})]},e.id))})]}),(()=>{let s=e.activities?.find(e=>"drive_links_added"===e.type&&e.metadata?.driveLinks),t=s?.metadata?.driveLinks||[];return t.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),"Google Drive & Dokument"]}),(0,a.jsx)("div",{className:"space-y-3",children:t.map((e,s)=>(0,a.jsxs)(i.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(h.C,{variant:"outline",className:"text-xs flex items-center gap-1",children:"folder"===e.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{className:"h-3 w-3"}),"Mapp"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{className:"h-3 w-3"}),"Dokument"]})})}),(0,a.jsx)(r.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs",children:[(0,a.jsx)(D.Z,{className:"h-3 w-3 mr-1"}),"\xd6ppna"]})})]}),(0,a.jsx)("h5",{className:"font-medium text-sm mb-1",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]},s))})]})})(),e.notes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"\xd6vriga anteckningar"}),(0,a.jsx)("div",{className:"bg-amber-50 p-3 rounded-md border-l-4 border-amber-400",children:(0,a.jsx)("p",{className:"text-sm",children:e.notes})})]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5"}),"Workflow & Framsteg"]})}),(0,a.jsx)(i.aY,{children:e.workflowSteps&&e.workflowSteps.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[A," av ",I," steg slutf\xf6rda"]}),(0,a.jsx)(u.Progress,{value:I>0?A/I*100:0,className:"w-24"})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:e.workflowSteps.slice(0,5).map((s,t)=>(0,a.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-semibold text-primary",children:t+1})}),(0,a.jsx)("button",{onClick:async()=>{try{(await fetch(`/api/cases/${e.id}/workflow-steps/${s.id}/toggle`,{method:"POST"})).ok&&window.location.reload()}catch(e){console.error("Failed to toggle step:",e)}},className:`w-4 h-4 rounded-full flex items-center justify-center transition-colors ${s.completed?"bg-green-500 hover:bg-green-600":"bg-border hover:bg-border/80"}`,children:s.completed?(0,a.jsx)(b.Z,{className:"w-3 h-3 text-white"}):(0,a.jsx)(Z.Z,{className:"w-3 h-3 text-muted-foreground"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h5",{className:`text-sm font-medium ${s.completed?"line-through text-muted-foreground":""}`,children:s.title}),s.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:s.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[s.dueDate&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(R.Z,{className:"w-3 h-3"}),new Date(s.dueDate).toLocaleDateString("sv-SE")]}),s.estimatedHours&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(T.Z,{className:"w-3 h-3"}),s.estimatedHours,"h"]}),s.assignedTo&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(v.Z,{className:"w-3 h-3"}),s.assignedTo.name||`${s.assignedTo.firstName} ${s.assignedTo.lastName}`.trim()]})]})]})]},s.id))}),e.workflowSteps.length>5&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)(r.z,{variant:"outline",size:"sm",onClick:()=>d("milestones"),children:["Se alla ",e.workflowSteps.length," steg"]})})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(b.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Inga workflow-steg definierade \xe4nnu"}),(0,a.jsx)("p",{className:"text-sm",children:"L\xe4gg till workflow-steg f\xf6r att sp\xe5ra framstegen"})]})})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)($.Z,{className:"h-5 w-5"}),"Case Chat"]}),(0,a.jsx)(Y,{caseId:e.id})]})}),(0,a.jsx)(i.aY,{className:"p-0",children:(0,a.jsx)("div",{className:"flex flex-col h-96",children:(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:0===e.comments.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[(0,a.jsx)($.Z,{className:"h-12 w-12 mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Ingen diskussion \xe4nnu"}),(0,a.jsx)("p",{className:"text-sm",children:"Starta konversationen om detta \xe4rende"})]}):e.comments.map(e=>{let t=e.author.id===s.id;return(0,a.jsxs)("div",{className:`flex gap-3 ${t?"flex-row-reverse":""}`,children:[(0,a.jsxs)(p,{className:"w-8 h-8 mt-1",children:[(0,a.jsx)(j,{src:e.author.image||""}),(0,a.jsx)(g,{className:"text-xs",children:e.author.name?.split(" ").map(e=>e[0]).join("").toUpperCase()})]}),(0,a.jsx)("div",{className:`flex-1 max-w-[75%] ${t?"items-end":""}`,children:(0,a.jsxs)("div",{className:`rounded-lg p-3 ${t?"bg-primary text-primary-foreground ml-auto":"bg-muted"}`,children:[(0,a.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${t?"justify-end":""}`,children:[(0,a.jsx)("span",{className:"font-medium text-xs",children:t?"Du":e.author.name}),(0,a.jsx)("span",{className:`text-xs ${t?"text-primary-foreground/70":"text-muted-foreground"}`,children:(0,F.Q)(new Date(e.createdAt),{addSuffix:!0})}),e.isInternal&&(0,a.jsx)(h.C,{variant:t?"outline":"secondary",className:"text-xs",children:"Internt"})]}),(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:e.content})]})})]},e.id)})})})})]})]})}),(0,a.jsx)(x,{value:"milestones",className:"space-y-6",children:(0,a.jsx)(eh,{caseId:e.id,steps:e.workflowSteps||[],users:t,currentUser:s})}),(0,a.jsxs)(x,{value:"documents",className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Case Documents"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"All files and documents related to this case"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.files.map(e=>(0,a.jsx)(i.Zb,{className:"hover:shadow-md transition-shadow",children:(0,a.jsxs)(i.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsx)(w.Z,{className:"w-10 h-10 text-blue-500"}),(0,a.jsx)(h.C,{variant:"secondary",className:"text-xs",children:e.mimeType.split("/")[1]?.toUpperCase()})]}),(0,a.jsx)("h3",{className:"font-semibold mb-2 truncate",title:e.originalName,children:e.originalName}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsxs)("p",{children:["Size: ",(e.fileSize/1024).toFixed(1)," KB"]}),(0,a.jsxs)("p",{children:["Uploaded by: ",e.uploadedBy.name]}),(0,a.jsxs)("p",{children:["Date: ",new Date(e.uploadedAt).toLocaleDateString()]})]}),(0,a.jsx)(r.z,{className:"w-full mt-3",variant:"outline",size:"sm",asChild:!0,children:(0,a.jsx)("a",{href:`/api/files/${e.fileName}`,download:!0,children:"Download"})})]})},e.id)),0===e.files.length&&(0,a.jsxs)("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:[(0,a.jsx)(w.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No documents uploaded yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Upload files from the main cases page"})]})]})]}),(0,a.jsxs)(x,{value:"time",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Log hours worked on this case"})]}),(0,a.jsx)(U,{caseId:e.id})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[e.actualHours.toFixed(1),"h"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Hours"})]}),(0,a.jsx)(y.Z,{className:"w-8 h-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-2xl font-bold law-gold",children:["$",f.toLocaleString()]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Billable Amount"})]}),(0,a.jsx)(z.Z,{className:"w-8 h-8 text-muted-foreground"})]})})}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.timeEntries.length}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Time Entries"})]}),(0,a.jsx)(T.Z,{className:"w-8 h-8 text-muted-foreground"})]})})})]}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-0",children:(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"border-b",children:(0,a.jsxs)("tr",{className:"text-left",children:[(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Date"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"User"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Description"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Hours"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Rate"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Amount"}),(0,a.jsx)("th",{className:"p-4 font-semibold",children:"Billable"})]})}),(0,a.jsx)("tbody",{children:e.timeEntries.map(e=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"p-4",children:new Date(e.date).toLocaleDateString()}),(0,a.jsx)("td",{className:"p-4",children:e.user.name}),(0,a.jsx)("td",{className:"p-4",children:e.description||"-"}),(0,a.jsxs)("td",{className:"p-4",children:[e.hours,"h"]}),(0,a.jsxs)("td",{className:"p-4",children:["$",e.hourlyRate||"-"]}),(0,a.jsxs)("td",{className:"p-4",children:["$",e.amount||"-"]}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)(h.C,{variant:e.billable?"default":"secondary",children:e.billable?"Yes":"No"})})]},e.id))})]}),0===e.timeEntries.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(y.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No time entries recorded yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Start tracking time to monitor case profitability"})]})]})})})]}),(0,a.jsxs)(x,{value:"legal",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Legal Research & References"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Relevant statutes, case law, and legal resources"})]}),(0,a.jsx)(W,{caseId:e.id})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.legalRefs.map(e=>(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(h.C,{variant:"outline",className:"mb-2",children:e.type.replace("_"," ").toUpperCase()}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.citation})]}),e.url&&(0,a.jsx)(r.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:"View Source"})})]}),e.summary&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Summary"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.summary})]}),e.relevance&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Relevance to Case"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.relevance})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Added by ",e.addedBy.name," on ",new Date(e.createdAt).toLocaleDateString()]})]})},e.id)),0===e.legalRefs.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(C.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No legal references added yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Add relevant statutes and case law to support your case"})]})]})]}),(0,a.jsxs)(x,{value:"activity",className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Case Activity Log"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Complete history of all case actions"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.activities.map(e=>(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsxs)(p,{className:"w-8 h-8",children:[(0,a.jsx)(j,{src:e.user?.image||""}),(0,a.jsx)(g,{children:e.user?.name?.split(" ").map(e=>e[0]).join("").toUpperCase()||"SY"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["by ",e.user?.name||"System"," • ",(0,F.Q)(new Date(e.createdAt),{addSuffix:!0})]})]})]}),(0,a.jsx)(h.C,{variant:"secondary",className:"text-xs",children:e.type.replace("_"," ")})]})})},e.id)),0===e.activities.length&&(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,a.jsx)("p",{children:"No activities recorded yet"})})]})]})]})]})}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return n}});var a=t(7437);t(2265);var l=t(7712),r=t(4508);let i=(0,l.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:s,...t}){return(0,a.jsx)("div",{className:(0,r.cn)(i({variant:s}),e),...t})}},6070:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},eW:function(){return m},ll:function(){return d}});var a=t(7437),l=t(2265),r=t(4508);let i=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));i.displayName="Card";let n=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...s}));n.displayName="CardHeader";let d=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));d.displayName="CardTitle";let c=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",e),...s}));c.displayName="CardDescription";let o=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent";let m=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",e),...s}));m.displayName="CardFooter"},1800:function(e,s,t){"use strict";t.d(s,{X:function(){return d}});var a=t(7437),l=t(2265),r=t(9270),i=t(401),n=t(4508);let d=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.fC,{ref:t,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:(0,a.jsx)(r.z$,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})}));d.displayName=r.fC.displayName},6110:function(e,s,t){"use strict";t.d(s,{$N:function(){return f},Be:function(){return p},Vq:function(){return d},cN:function(){return u},cZ:function(){return x},fK:function(){return h},hg:function(){return c}});var a=t(7437),l=t(2265),r=t(9027),i=t(2489),n=t(4508);let d=r.fC,c=r.xz,o=r.h_;r.x8;let m=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.aV,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));m.displayName=r.aV.displayName;let x=l.forwardRef(({className:e,children:s,...t},l)=>(0,a.jsxs)(o,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(r.VY,{ref:l,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[s,(0,a.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));x.displayName=r.VY.displayName;let h=({className:e,...s})=>(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});h.displayName="DialogHeader";let u=({className:e,...s})=>(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});u.displayName="DialogFooter";let f=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));f.displayName=r.Dx.displayName;let p=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",e),...s}));p.displayName=r.dk.displayName},6815:function(e,s,t){"use strict";t.d(s,{_:function(){return c}});var a=t(7437),l=t(2265),r=t(6394),i=t(7712),n=t(4508);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.f,{ref:t,className:(0,n.cn)(d(),e),...s}));c.displayName=r.f.displayName},2759:function(e,s,t){"use strict";t.d(s,{Progress:function(){return n}});var a=t(7437),l=t(2265),r=t(610),i=t(4508);let n=l.forwardRef(({className:e,value:s,...t},l)=>(0,a.jsx)(r.fC,{ref:l,className:(0,i.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:(0,a.jsx)(r.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));n.displayName=r.fC.displayName},3647:function(e,s,t){"use strict";t.d(s,{Bw:function(){return f},Ph:function(){return o},Ql:function(){return p},i4:function(){return x},ki:function(){return m}});var a=t(7437),l=t(2265),r=t(3402),i=t(875),n=t(2135),d=t(401),c=t(4508);let o=r.fC;r.ZA;let m=r.B4,x=l.forwardRef(({className:e,children:s,...t},l)=>(0,a.jsxs)(r.xz,{ref:l,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,(0,a.jsx)(r.JO,{asChild:!0,children:(0,a.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]}));x.displayName=r.xz.displayName;let h=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:(0,a.jsx)(n.Z,{className:"h-4 w-4"})}));h.displayName=r.u_.displayName;let u=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})}));u.displayName=r.$G.displayName;let f=l.forwardRef(({className:e,children:s,position:t="popper",...l},i)=>(0,a.jsx)(r.h_,{children:(0,a.jsxs)(r.VY,{ref:i,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...l,children:[(0,a.jsx)(h,{}),(0,a.jsx)(r.l_,{className:(0,c.cn)("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,a.jsx)(u,{})]})}));f.displayName=r.VY.displayName,l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s})).displayName=r.__.displayName;let p=l.forwardRef(({className:e,children:s,...t},l)=>(0,a.jsxs)(r.ck,{ref:l,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.wU,{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(r.eT,{children:s})]}));p.displayName=r.ck.displayName,l.forwardRef(({className:e,...s},t)=>(0,a.jsx)(r.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...s})).displayName=r.Z0.displayName},6818:function(e,s,t){"use strict";t.d(s,{g:function(){return i}});var a=t(7437),l=t(2265),r=t(4508);let i=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...s}));i.displayName="Textarea"}}]);